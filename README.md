# README

Этот репозиторий содержит набор скриптов, предназначенных для автоматизации различных задач, таких как взаимодействие с API, отправка уведомлений по электронной почте, а также обработки и анализ данных. Каждый скрипт выполняет отдельную задачу, и их можно использовать в рамках различных рабочих процессов для мониторинга, отчётности и уведомлений.

## Содержимое репозитория

1. **Скрипт 1: Интеграция с Zabbix**
   - Скрипт, который получает данные о событиях через API и анализирует их для передачи в систему мониторинга Zabbix. 
   - Используется для мониторинга и управления событиями без назначенных ответственных.
   
2. **Скрипт 2: Получение данных из Elasticsearch и отправка отчета по электронной почте**
   - Скрипт, который извлекает данные из Elasticsearch за последний день, конвертирует их в CSV формат, а затем отправляет этот CSV-файл на указанные email-адреса с вложением.
   - Это полезно для создания регулярных отчетов по данным, хранящимся в Elasticsearch.

3. **Скрипт 3: Отправка уведомлений об оплате пользователям с вложением**
   - Скрипт для отправки email-уведомлений пользователям, которым необходимо произвести оплату (например, за VPN сервис). В письме отправляется QR-код для оплаты в виде вложения.
   - Работает с конфигурационными файлами для отправителей и получателей, а также поддерживает автоматическое обновление статуса оплаты пользователей.

## Установка

Перед использованием скриптов убедитесь, что у вас установлены все необходимые зависимости. Для установки зависимостей создайте виртуальное окружение и установите все пакеты через `requirements.txt` (если файл присутствует):

```bash
# Создание виртуального окружения (если необходимо)
python3 -m venv .venv

# Активация виртуального окружения
source .venv/bin/activate  # для Linux/Mac
.venv\Scripts\activate  # для Windows

# Установка зависимостей
pip install -r requirements.txt
```

## Конфигурация

Для работы скриптов требуется корректная настройка конфигурационных файлов, которые содержат важные данные для подключения и работы:

1. **`sender.ini`** — используется в скрипте отправки уведомлений. Должен содержать информацию для логина на SMTP-сервер.
   ```ini
   [sender]
   mail = example@example.com
   password = yourpassword
   ```

2. **`users.ini`** — используется для хранения информации о пользователях, которым нужно отправить уведомления, а также данных о тех, кто уже оплатил.
   ```ini
   [users]
   user1 = user1@example.com
   user2 = user2@example.com

   [paid]
   user1 = 1
   ```

3. **`conf.ini`** — используется для конфигурации Elasticsearch в некоторых скриптах. Содержит данные о сервере и параметрах доступа.
   ```ini
   [mail]
   from = example@example.com
   to = recipient@example.com
   log_el = elasticsearch_host
   pass_el = elastic_password
   ```

## Использование

### Скрипт 1: Интеграция с Zabbix

1. Убедитесь, что у вас настроены Zabbix сервер и агент.
2. Выполните скрипт, передав необходимые аргументы:
   ```bash
   ./zabbix_integration.py --server <zabbix-server> --host <host> --item <item>
   ```

### Скрипт 2: Получение данных из Elasticsearch и отправка отчета по электронной почте

1. Убедитесь, что ваш Elasticsearch доступен по сети.
2. Запустите скрипт с необходимыми параметрами:
   ```bash
   ./elasticsearch_report.py -f <from_mail> -t <to_mail> -p <password> -i <index_name>
   ```

### Скрипт 3: Отправка уведомлений об оплате

1. Убедитесь, что ваши конфигурационные файлы корректно настроены.
2. Запустите скрипт:
   ```bash
   ./send_payment_email.py
   ```

## Примечания

- Все скрипты предполагают наличие определённых конфигурационных файлов (`sender.ini`, `users.ini`, `conf.ini`), которые должны быть настроены заранее.
- Скрипты используют стандартные библиотеки Python для обработки HTTP-запросов, работы с SMTP, а также для парсинга и записи в конфигурационные файлы.

